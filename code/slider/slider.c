#include "slider.h"#include "../tools/tools.h"#include "../button/button.h"Slider *create_slider(Game *game, SDL_Rect rect) {    printf("creating slider\n");    int t = 7; // thickness    Slider *slider = (Slider *)malloc(sizeof(Slider));    if (!slider) {        printf("Error: Failed to allocate slider\n");        return NULL;    }    slider->rect = rect;    slider->color = game->slider_fill_color;    slider->is_hovered = 0;    slider->is_clicked = 0;    slider->val = 10;    slider->bg = create_color_surface(rect.w, rect.h, game->slider_bg_color.r, game->slider_bg_color.g, game->slider_bg_color.b);    slider->fill = create_color_surface(rect.w - t, rect.h - t, game->slider_fill_color.r, game->slider_fill_color.g, game->slider_fill_color.b);    slider->s_rect = (SDL_Rect){rect.x + t / 2, rect.y + t / 2, rect.w - t, rect.h - t};    slider->s_rect.w = (rect.w - t) * slider->val / 100;    // Button    slider->b_size = 30;    slider->b_color = (SDL_Color){10, 10, 10};    slider->b_rect = (SDL_Rect){        rect.x + (rect.w - slider->b_size) * slider->val / 100,        rect.y + (rect.h - slider->b_size) / 2,        slider->b_size,        slider->b_size    };    slider->bh = create_color_surface(slider->b_size, slider->b_size, slider->b_color.r, slider->b_color.g, slider->b_color.b);    slider->b = create_color_surface(slider->b_size, slider->b_size, slider->b_color.r + 50, slider->b_color.g + 50, slider->b_color.b + 50);    return slider;}void update_slider(Game *game, Slider *slider, int value) {    // Handle external value updates (e.g., from button clicks like volume toggle)    if (value >= 0 && value <= 100) {        slider->val = value;        // Update button position based on value        slider->b_rect.x = slider->rect.x + (slider->rect.w - slider->b_size) * slider->val / 100;        // Update fill width        slider->s_rect.w = (slider->rect.w - 7) * slider->val / 100; // 7 is thickness        SDL_FreeSurface(slider->fill);        slider->fill = create_color_surface(slider->s_rect.w, slider->s_rect.h, slider->color.r, slider->color.g, slider->color.b);    }    // Update hover state    slider->is_hovered = is_hovered(game, &slider->b_rect);    // Handle dragging when the button is pressed    if (is_pressed(game, &slider->b_rect)) {        slider->is_clicked = 1;    } else if (game->released_mouse) {        slider->is_clicked = 0;        slider->is_hovered = 0;    }    if (slider->is_clicked) {        slider->is_hovered = 1;        // Calculate new button position based on mouse X, keeping it within bounds        int new_x = game->x_mouse - slider->b_size / 2;        int min_x = slider->rect.x;        int max_x = slider->rect.x + slider->rect.w - slider->b_size;        if (new_x < min_x) new_x = min_x;        if (new_x > max_x) new_x = max_x;        slider->b_rect.x = new_x;        // Calculate value based on button position        slider->val = (int)(100.0 * (slider->b_rect.x - slider->rect.x) / (slider->rect.w - slider->b_size));        // Update fill width based on new value        slider->s_rect.w = (slider->rect.w - 7) * slider->val / 100;        SDL_FreeSurface(slider->fill);        slider->fill = create_color_surface(slider->s_rect.w, slider->s_rect.h, slider->color.r, slider->color.g, slider->color.b);    }    // Update button y-position to stay centered vertically    slider->b_rect.y = slider->rect.y + (slider->rect.h - slider->b_size) / 2;}void update_sliders(Game *game, Slider *sliders, int s_ct) {    for (int i = 0; i < s_ct; i++) {        update_slider(game, &sliders[i], -1); // -1 indicates no external value update    }}void render_slider(Game *game, Slider *slider) {    SDL_BlitSurface(slider->bg, NULL, game->screen, &slider->rect);    SDL_BlitSurface(slider->fill, NULL, game->screen, &slider->s_rect);    if (slider->is_hovered) {        SDL_BlitSurface(slider->bh, NULL, game->screen, &slider->b_rect);    } else {        SDL_BlitSurface(slider->b, NULL, game->screen, &slider->b_rect);    }}void render_sliders(Game *game, Slider *sliders, int s_ct) {    for (int i = 0; i < s_ct; i++) {        render_slider(game, &sliders[i]);    }}void free_slider(Slider *slider) {    if (slider) {        if (slider->bg) SDL_FreeSurface(slider->bg);        if (slider->fill) SDL_FreeSurface(slider->fill);        if (slider->b) SDL_FreeSurface(slider->b);        if (slider->bh) SDL_FreeSurface(slider->bh);        free(slider);    }}